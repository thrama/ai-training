<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EDC Explorer - Lorenzo @ NTT Data</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .mode-indicator {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            display: inline-block;
            margin-top: 10px;
            font-weight: 600;
        }

        .mode-indicator.real {
            background: #4CAF50;
        }

        .mode-indicator.mock {
            background: #ff9800;
        }

        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 2px solid #ddd;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            background: #f5f5f5;
            border: none;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #e0e0e0;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.5em;
            color: #667eea;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .instructions {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 4px solid #2196F3;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        input[type="text"], input[type="number"], select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus, input[type="number"]:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }

        button {
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #4CAF50;
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .status {
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            font-weight: 600;
        }

        .status.info {
            background: #e3f2fd;
            color: #1976d2;
            border-left: 4px solid #2196F3;
        }

        .status.success {
            background: #e8f5e9;
            color: #388e3c;
            border-left: 4px solid #4CAF50;
        }

        .status.error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
        }

        .status.loading {
            background: #fff3e0;
            color: #f57c00;
            border-left: 4px solid #ff9800;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .results-table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .results-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #ddd;
        }

        .results-table tr:hover {
            background: #f5f5f5;
            cursor: pointer;
        }

        .log-container {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 500px;
            overflow-y: auto;
        }

        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid transparent;
        }

        .log-entry.info { border-left-color: #2196F3; }
        .log-entry.success { border-left-color: #4CAF50; }
        .log-entry.error { border-left-color: #f44336; }
        .log-entry.debug { border-left-color: #9e9e9e; }
        .log-entry.api { 
            border-left-color: #ff9800; 
            background: #2a2a2a;
            padding: 10px;
            margin: 10px 0;
        }

        .result-text {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #ddd;
            max-height: 600px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
        }

        .resource-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .resource-btn {
            padding: 10px 20px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .resource-btn.active {
            background: #667eea;
            color: white;
        }

        .resource-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>EDC Lineage Explorer</h1>
            <p>Enterprise Data Catalog & AI Analytics - Sviluppato per Lorenzo @ NTT Data Italia</p>
            <div class="mode-indicator real" id="mode-indicator">
                üü¢ PRODUCTION MODE - Server Connesso
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('search')">Ricerca Asset</button>
            <button class="tab" onclick="showTab('lineage')">Lineage</button>
            <button class="tab" onclick="showTab('impact')">Analisi Impatto</button>
            <button class="tab" onclick="showTab('system')">Sistema & Debug</button>
        </div>

        <!-- TAB SEARCH -->
        <div id="search" class="tab-content active">
            <div class="section">
                <div class="section-title">Ricerca Asset nel Catalogo EDC</div>
                
                <div class="instructions">
                    <strong>Istruzioni:</strong><br>
                    1. La Resource √® fissa su DataPlatform<br>
                    2. Inserisci un filtro nel nome (es. GARANZIE, CLIENTE, SOFFERENZE)<br>
                    3. Clicca "CERCA ASSET"<br>
                    4. Visualizza i risultati nella tabella sotto<br>
                    5. Controlla il Tab Sistema per vedere i log dettagliati
                </div>

                <div class="form-group">
                    <label>Resource (fisso)</label>
                    <input type="text" value="DataPlatform" readonly style="background: #f0f0f0;">
                </div>

                <div class="form-group">
                    <label>Filtro Nome Asset</label>
                    <input type="text" id="search-filter" placeholder="es. GARANZIE, CLIENTE, SOFFERENZE">
                </div>

                <button class="btn-success" onclick="searchAssets()" style="width: 100%; font-size: 1.2em; padding: 15px;">
                    CERCA ASSET
                </button>

                <div id="search-status" class="status info">
                    Pronto per la ricerca
                </div>

                <div id="search-results"></div>
            </div>
        </div>

        <!-- TAB LINEAGE -->
        <div id="lineage" class="tab-content">
            <div class="section">
                <div class="section-title">Esplorazione Lineage</div>
                
                <div class="instructions">
                    <strong>Istruzioni:</strong><br>
                    1. Inserisci Asset ID completo nel formato: DataPlatform://CONNECTION/SCHEMA/TABLE_NAME<br>
                    2. Esempio: DataPlatform://ORAC51/DWHEVO/IFR_WK_GARANZIE_DT<br>
                    3. Seleziona direzione (Upstream/Downstream/Both)<br>
                    4. Imposta profondit√† (1-5, default 3)<br>
                    5. Clicca "COSTRUISCI ALBERO"
                </div>

                <div class="form-group">
                    <label>Asset ID Completo</label>
                    <input type="text" id="lineage-asset-id" placeholder="DataPlatform://ORAC51/DWHEVO/IFR_WK_GARANZIE_DT">
                </div>

                <div class="form-group">
                    <label>Direzione</label>
                    <div class="resource-buttons">
                        <button class="resource-btn" onclick="selectDirection('upstream')">Upstream (Sorgenti)</button>
                        <button class="resource-btn active" onclick="selectDirection('both')">Both (Entrambi)</button>
                        <button class="resource-btn" onclick="selectDirection('downstream')">Downstream (Target)</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>Profondit√† (1-5)</label>
                    <input type="number" id="lineage-depth" value="3" min="1" max="5">
                </div>

                <button class="btn-success" onclick="buildLineage()" style="width: 100%; font-size: 1.2em; padding: 15px;">
                    COSTRUISCI ALBERO
                </button>

                <div id="lineage-status" class="status info">
                    Inserisci Asset ID per iniziare
                </div>

                <div id="lineage-results"></div>
            </div>
        </div>

        <!-- TAB IMPACT -->
        <div id="impact" class="tab-content">
            <div class="section">
                <div class="section-title">Analisi Impatto Modifiche</div>
                
                <div class="instructions">
                    <strong>Istruzioni:</strong><br>
                    1. Inserisci Asset ID da modificare<br>
                    2. Seleziona tipo di modifica<br>
                    3. Descrivi la modifica in dettaglio<br>
                    4. Clicca "Analizza Impatto" o "Genera Checklist"
                </div>

                <div class="form-group">
                    <label>Asset ID</label>
                    <input type="text" id="impact-asset-id" placeholder="DataPlatform://ORAC51/DWHEVO/TABLE_NAME">
                </div>

                <div class="form-group">
                    <label>Tipo Modifica</label>
                    <div class="resource-buttons">
                        <button class="resource-btn active" onclick="selectChangeType('column_drop')">Column Drop</button>
                        <button class="resource-btn" onclick="selectChangeType('data_type_change')">Data Type Change</button>
                        <button class="resource-btn" onclick="selectChangeType('deprecation')">Deprecation</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>Descrizione Modifica</label>
                    <textarea id="impact-description" rows="3" placeholder="Descrivi dettagliatamente la modifica..."></textarea>
                </div>

                <div class="button-group">
                    <button class="btn-primary" onclick="analyzeImpact()" style="flex: 1;">Analizza Impatto</button>
                    <button class="btn-success" onclick="generateChecklist()" style="flex: 1;">Genera Checklist</button>
                </div>

                <div id="impact-status" class="status info">
                    Compila i campi per iniziare
                </div>

                <div id="impact-results"></div>
            </div>
        </div>

        <!-- TAB SYSTEM -->
        <div id="system" class="tab-content">
            <div class="section">
                <div class="section-title">Sistema & Debug</div>
                
                <div class="form-group">
                    <label>Stato Connessione</label>
                    <div class="status success" id="connection-status">
                        üü¢ Connesso a http://localhost:8080 (Production Mode)
                    </div>
                </div>

                <div class="form-group">
                    <label>Log Debug (Chiamate API e Operazioni)</label>
                    <div class="log-container" id="debug-log">
                        <div class="log-entry info">[INFO] EDC Explorer Web Interface Ready</div>
                        <div class="log-entry success">[SUCCESS] Production mode active</div>
                        <div class="log-entry info">[INFO] Server: http://localhost:8080</div>
                        <div class="log-entry info">[INFO] Waiting for user interaction...</div>
                    </div>
                </div>

                <button class="btn-secondary" onclick="clearLog()">Pulisci Log</button>
            </div>
        </div>
    </div>

    <script>
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // CONFIGURAZIONE
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        const API_BASE_URL = 'http://localhost:8080/api/mcp';
        const USE_REAL_API = true;  // üöÄ PRODUCTION MODE
        
        // Stato globale
        let selectedDirection = 'both';
        let selectedChangeType = 'column_drop';

        // Log iniziale
        if (USE_REAL_API) {
            addLog('success', 'üöÄ PRODUCTION MODE ACTIVE');
            addLog('info', `API Server: ${API_BASE_URL}`);
            addLog('info', 'Chiamate reali al server EDC');
        } else {
            addLog('info', 'üé≠ MOCK MODE ACTIVE');
            addLog('info', 'Using simulated data');
        }

        // Funzioni UI
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            addLog('info', `Tab changed: ${tabName}`);
        }

        function selectDirection(direction) {
            selectedDirection = direction;
            document.querySelectorAll('#lineage .resource-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            addLog('info', `Direction selected: ${direction}`);
        }

        function selectChangeType(type) {
            selectedChangeType = type;
            document.querySelectorAll('#impact .resource-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            addLog('info', `Change type selected: ${type}`);
        }

        function addLog(level, message, data = null) {
            const logContainer = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString('it-IT', { hour12: false, fractionalSecondDigits: 3 });
            const entry = document.createElement('div');
            entry.className = `log-entry ${level}`;
            
            let logText = `[${timestamp}] [${level.toUpperCase()}] ${message}`;
            
            if (data) {
                logText += '\n    ' + JSON.stringify(data, null, 2).split('\n').join('\n    ');
            }
            
            entry.textContent = logText;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function logAPICall(method, params) {
            const logContainer = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString('it-IT', { hour12: false, fractionalSecondDigits: 3 });
            const entry = document.createElement('div');
            entry.className = 'log-entry api';
            
            const curlCommand = `curl -X POST ${API_BASE_URL}/${method} \\
  -H "Content-Type: application/json" \\
  -d '${JSON.stringify(params, null, 2).replace(/\n/g, '\n      ')}'`;
            
            let apiCall = `üîµ API CALL\n`;
            apiCall += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            apiCall += `Method: ${method}\n`;
            apiCall += `Timestamp: ${timestamp}\n`;
            apiCall += `\n`;
            apiCall += `HTTP Request:\n`;
            apiCall += `  POST ${API_BASE_URL}/${method} HTTP/1.1\n`;
            apiCall += `  Host: localhost:8080\n`;
            apiCall += `  Content-Type: application/json\n`;
            apiCall += `\n`;
            apiCall += `Request Body:\n`;
            apiCall += JSON.stringify(params, null, 2);
            apiCall += `\n\n`;
            apiCall += `Equivalent cURL Command:\n`;
            apiCall += curlCommand;
            apiCall += `\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`;
            
            entry.textContent = apiCall;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            addLog('debug', `‚Üí Calling API: ${method}`);
        }

        function logAPIResponse(method, success, data = null, error = null) {
            const logContainer = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString('it-IT', { hour12: false, fractionalSecondDigits: 3 });
            const entry = document.createElement('div');
            entry.className = 'log-entry api';
            
            let apiResponse = success ? `üü¢ API RESPONSE (SUCCESS)\n` : `üî¥ API RESPONSE (ERROR)\n`;
            apiResponse += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            apiResponse += `Method: ${method}\n`;
            apiResponse += `Timestamp: ${timestamp}\n`;
            apiResponse += `Status: ${success ? '200 OK' : '500 ERROR'}\n`;
            apiResponse += `\n`;
            
            if (success) {
                apiResponse += `Response Data:\n`;
                apiResponse += JSON.stringify(data, null, 2);
            } else {
                apiResponse += `Error:\n`;
                apiResponse += error || 'Unknown error';
                if (data) {
                    apiResponse += `\nDebug Data:\n`;
                    apiResponse += JSON.stringify(data, null, 2);
                }
            }
            apiResponse += `\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`;
            
            entry.textContent = apiResponse;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            if (success) {
                addLog('success', `‚Üê Response from: ${method}`);
            } else {
                addLog('error', `‚Üê Error from: ${method}`, { error: error });
            }
        }

        function clearLog() {
            document.getElementById('debug-log').innerHTML = '';
            addLog('info', 'Log cleared');
        }

        function updateStatus(elementId, message, type) {
            const status = document.getElementById(elementId);
            status.textContent = message;
            status.className = `status ${type}`;
        }

        // Mock Data Generator (per fallback)
        function generateMockAssets(filter) {
            const connections = ['ORAC51', 'ORAC52'];
            const schemas = ['DWHEVO', 'STG', 'MART', 'ODS'];
            const prefixes = ['IFR_WK_', 'DIM_', 'FACT_', 'STG_', 'TMP_'];
            const domains = ['GARANZIE', 'SOFFERENZE', 'CUSTOMER', 'ACCOUNT', 'TRANSACTION'];
            const suffixes = ['_DT', '_AP', '_HIST', '_CURRENT', '_SUMMARY'];
            const types = ['Table', 'View', 'Column'];

            const assets = [];
            for (let i = 0; i < 20; i++) {
                const conn = connections[Math.floor(Math.random() * connections.length)];
                const schema = schemas[Math.floor(Math.random() * schemas.length)];
                const prefix = prefixes[Math.floor(Math.random() * prefixes.length)];
                const domain = domains[Math.floor(Math.random() * domains.length)];
                const suffix = suffixes[Math.floor(Math.random() * suffixes.length)];
                const type = types[Math.floor(Math.random() * types.length)];

                const name = prefix + domain + suffix;
                
                if (!filter || name.toUpperCase().includes(filter.toUpperCase())) {
                    assets.push({
                        id: `DataPlatform://${conn}/${schema}/${name}`,
                        name: name,
                        type: type,
                        connection: conn,
                        schema: schema
                    });
                }
            }
            return assets;
        }

        // Funzione Ricerca Asset
        async function searchAssets() {
            addLog('info', '='.repeat(70));
            addLog('info', 'INIZIO RICERCA ASSET');
            addLog('info', '='.repeat(70));
            
            const filter = document.getElementById('search-filter').value;
            const resource = 'DataPlatform';
            
            addLog('info', `Resource: ${resource}`);
            addLog('info', `Filtro nome: "${filter}"`);
            addLog('info', `Mode: ${USE_REAL_API ? 'REAL API' : 'MOCK'}`);
            
            const params = {
                resource_name: resource,
                name_filter: filter || null,
                max_results: 20
            };
            
            logAPICall('search_assets', params);
            updateStatus('search-status', '‚è≥ Invio richiesta al server...', 'loading');
            
            if (USE_REAL_API) {
                try {
                    addLog('info', `Sending HTTP POST to ${API_BASE_URL}/search_assets`);
                    
                    const response = await fetch(`${API_BASE_URL}/search_assets`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(params)
                    });
                    
                    addLog('info', `Response status: ${response.status} ${response.statusText}`);
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        throw new Error(`HTTP ${response.status}: ${errorText}`);
                    }
                    
                    const data = await response.json();
                    
                    addLog('info', `Parsing response...`);
                    addLog('info', `Found ${data.results_count} assets`);
                    
                    logAPIResponse('search_assets', true, {
                        results_count: data.results_count,
                        execution_time_ms: data.execution_time_ms
                    });
                    
                    if (data.results && data.results.length > 0) {
                        let html = '<table class="results-table">';
                        html += '<thead><tr><th>Nome</th><th>Tipo</th><th>Connection</th><th>Schema</th></tr></thead>';
                        html += '<tbody>';
                        
                        data.results.forEach((asset, index) => {
                            addLog('debug', `  Riga ${index + 1}: ${asset.name}`, {
                                id: asset.id,
                                type: asset.type,
                                connection: asset.connection,
                                schema: asset.schema
                            });
                            
                            html += `<tr onclick="showAssetDetails('${asset.id}')">`;
                            html += `<td>${asset.name}</td>`;
                            html += `<td>${asset.type}</td>`;
                            html += `<td>${asset.connection}</td>`;
                            html += `<td>${asset.schema}</td>`;
                            html += '</tr>';
                        });
                        
                        html += '</tbody></table>';
                        document.getElementById('search-results').innerHTML = html;
                        
                        updateStatus('search-status', `‚úÖ Trovati ${data.results_count} asset. Clicca su una riga per dettagli.`, 'success');
                    } else {
                        document.getElementById('search-results').innerHTML = '<p style="padding: 20px; text-align: center; color: #666;">Nessun asset trovato.</p>';
                        updateStatus('search-status', '‚ÑπÔ∏è Nessun asset trovato', 'info');
                    }
                    
                    addLog('success', 'RICERCA COMPLETATA CON SUCCESSO');
                    
                } catch (error) {
                    addLog('error', `ERRORE CHIAMATA API: ${error.message}`);
                    logAPIResponse('search_assets', false, null, error.message);
                    updateStatus('search-status', `‚ùå Errore: ${error.message}`, 'error');
                }
                
            } else {
                setTimeout(() => {
                    addLog('info', 'Using MOCK data...');
                    const assets = generateMockAssets(filter);
                    
                    logAPIResponse('search_assets', true, {
                        results_count: assets.length,
                        execution_time_ms: 234
                    });
                    
                    if (assets.length > 0) {
                        let html = '<table class="results-table">';
                        html += '<thead><tr><th>Nome</th><th>Tipo</th><th>Connection</th><th>Schema</th></tr></thead>';
                        html += '<tbody>';
                        
                        assets.forEach(asset => {
                            html += `<tr onclick="showAssetDetails('${asset.id}')">`;
                            html += `<td>${asset.name}</td>`;
                            html += `<td>${asset.type}</td>`;
                            html += `<td>${asset.connection}</td>`;
                            html += `<td>${asset.schema}</td>`;
                            html += '</tr>';
                        });
                        
                        html += '</tbody></table>';
                        document.getElementById('search-results').innerHTML = html;
                        updateStatus('search-status', `‚úÖ Trovati ${assets.length} asset (MOCK).`, 'success');
                    }
                    
                    addLog('success', 'RICERCA MOCK COMPLETATA');
                }, 500);
            }
            
            addLog('info', '='.repeat(70));
        }

        function showAssetDetails(assetId) {
            addLog('info', '='.repeat(70));
            addLog('info', 'RICHIESTA DETTAGLI ASSET');
            
            const params = {
                asset_id: assetId
            };
            
            logAPICall('get_asset_details', params);
            addLog('info', `Asset ID: ${assetId}`);
            addLog('debug', 'Parsing asset ID components...', {
                full_id: assetId,
                resource: assetId.split('://')[0],
                path: assetId.split('://')[1]
            });
            
            alert(`üìã Dettagli Asset\n\nID: ${assetId}\n\n(Funzionalit√† dettagli completi in sviluppo)\n\nVedi log nel Tab Sistema per i dettagli della chiamata.`);
            
            logAPIResponse('get_asset_details', true, {
                asset_id: assetId,
                details: 'Feature coming soon'
            });
            
            addLog('info', '='.repeat(70));
        }

        // Funzione Build Lineage (stub - implementa come searchAssets)
        async function buildLineage() {
            addLog('info', 'Lineage feature - coming soon');
            updateStatus('lineage-status', 'Funzionalit√† in fase di implementazione', 'info');
        }

        // Funzione Analisi Impatto (stub)
        async function analyzeImpact() {
            addLog('info', 'Impact analysis feature - coming soon');
            updateStatus('impact-status', 'Funzionalit√† in fase di implementazione', 'info');
        }

        // Funzione Genera Checklist (stub)
        async function generateChecklist() {
            addLog('info', 'Checklist generation feature - coming soon');
            updateStatus('impact-status', 'Funzionalit√† in fase di implementazione', 'info');
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                const activeTab = document.querySelector('.tab-content.active');
                if (activeTab.id === 'search') searchAssets();
            }
        });
    </script>
</body>
</html>
